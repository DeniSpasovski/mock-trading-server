<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nes/10.0.2/client.js"></script>
    <script src="./script.js"></script>
    <!-- <link rel="stylesheet" href="css/styles.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/nes/10.0.2/client.js"></script> -->
</head>

<body>
    <p>Hello Codders</p>
    <p id='AAPL'></p>
    <p id='MSFT'></p>
</body>

<script>
    if (!localStorage['userId']) {
        localStorage['userId'] = 'User' + new Date().getMilliseconds()
    }

    function updatePrice(update) {
        document.getElementById(update.stock).innerHTML = `<b>${update.stock}</b> ${update.price ? update.price.toFixed(2) : 'n/a'}`;
    }
    subscribeToLiveUpdates('AAPL', updatePrice);
    subscribeToLiveUpdates('MSFT', updatePrice);

    function getUserData() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", './userdata', false);
        xmlHttp.setRequestHeader("userid", localStorage['userId']);
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    function postUserData(data, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST", './userdata', false);
        xmlHttp.setRequestHeader("userid", localStorage['userId']);
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
                console.log(xmlHttp.responseText);
                if (callback) callback();
            }
        };
        xmlHttp.send(JSON.stringify(data));
    }

    postUserData({
        userId: localStorage['userId'],
        stocks: ['AAPL', 'MSFT']
    }, getUserData)
</script>

</html>